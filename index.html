<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <title>Huhn Klicker</title>
    <style>
      body {
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background: #f0f0f0;
        font-family: Arial, sans-serif;
      }
      #counter-boxes {
        position: absolute;
        top: 20px;
        left: 20px;
        font-size: 24px;
        display: flex;
        flex-direction: column;
      }
      #button-boxes {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 24px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      #button-boxes button {
        margin-top: 5px;
      }
      #container {
        position: relative;
      }
      #cage-heading {
        text-align: center;
        margin: 0;
      }
      #chicken {
        position: relative;
        z-index: 1;
        font-size: 100px;
        cursor: pointer;
        user-select: none;
      }
      .egg {
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        font-size: 40px;
        animation: drop 3s forwards;
        z-index: 0;
      }
      @keyframes drop {
        0% {
          top: 0;
          opacity: 1;
        }
        100% {
          top: 200px;
          opacity: 0;
        }
      }
    #banner {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border: 2px solid black;
      padding: 20px;
      font-size: 24px;
      display: none;
      z-index: 2;
    }
    #farm {
      position: absolute;
      top: 20px;
      right: 20px;
      border: 1px solid #333;
      padding: 10px;
      display: none;
    }
    </style>
  </head>
  <body>
    <div id="counter-boxes">
      <span id="egg-count">‚õì-Ei: 0</span>
      <span id="gold-count">ü™ô 0</span>
      <span id="merchant-count" style="display: none">H√§ndler: 0</span>
      <span id="chicken-count" style="display: none">‚õì-H√ºhner: 1</span>
      <span id="farmer-count" style="display: none">Farmer: 0</span>
    </div>

    <div id="button-boxes">
      <button id="merchant-btn" style="display: none">
        H√§ndler anheuern (5ü™ô)
      </button>
      <button id="buy-chicken-btn" style="display: none">‚õì-Huhn kaufen</button>
      <button id="sell-btn" style="display: none">8 Eier verkaufen</button>
      <button id="farmer-btn" style="display: none">
        Farmer anheuern (15ü™ô)
      </button>
      <button id="buy-farm-btn" style="display: none">Bauernhof kaufen (100ü™ô)</button>
    </div>
    <div id="container">
      <h1 id="cage-heading">‚õìfighaltung</h1>
      <div id="chicken">‚õìüêî‚õì</div>
    </div>
    <div id="farm">
      <h2>Bauernhof</h2>
      <span id="farm-farmer-count">Farmer: 0</span>
      <button id="assign-farmer-btn">Farmer zuweisen</button><br />
      <span id="farm-merchant-count">H√§ndler: 0</span>
      <button id="assign-merchant-btn">H√§ndler zuweisen</button><br />
      <span id="farm-chicken-type">Keine H√ºhner</span>
      <button id="assign-chicken-btn">‚õì-H√ºhner zuweisen</button>
    </div>
    <div id="banner"></div>
    <script>
      const chicken = document.getElementById("chicken");
      const eggCountEl = document.getElementById("egg-count");
      const merchantCountEl = document.getElementById("merchant-count");
      const sellBtn = document.getElementById("sell-btn");
      const goldCountEl = document.getElementById("gold-count");
      const merchantBtn = document.getElementById("merchant-btn");
      const buyChickenBtn = document.getElementById("buy-chicken-btn");
      const chickenCountEl = document.getElementById("chicken-count");
      const farmerBtn = document.getElementById("farmer-btn");
      const farmerCountEl = document.getElementById("farmer-count");
      const buyFarmBtn = document.getElementById("buy-farm-btn");
      const farmEl = document.getElementById("farm");
      const assignFarmerBtn = document.getElementById("assign-farmer-btn");
      const assignMerchantBtn = document.getElementById("assign-merchant-btn");
      const assignChickenBtn = document.getElementById("assign-chicken-btn");
      const farmFarmerCountEl = document.getElementById("farm-farmer-count");
      const farmMerchantCountEl = document.getElementById("farm-merchant-count");
      const farmChickenTypeEl = document.getElementById("farm-chicken-type");
      const bannerEl = document.getElementById("banner");
      let count = 0;
      let gold = 0;
      let merchantCount = 0;
      let merchantVisible = false;
      let chickenCount = 1;
      let buyChickenVisible = false;
      let farmerCount = 0;
      let farmerVisible = false;
      let progressStage = 0;
      const progressGoals = [5, 10, 15, 100];
      let farmBuilt = false;
      let farmFarmers = 0;
      let farmMerchants = 0;
      let farmChickenAssigned = false;
      let farmMultiplier = 1;
      let chapter2Shown = false;
      let farmChickenCount = 0;
      let clickInterval;

      function showBanner(text) {
        bannerEl.textContent = text;
        bannerEl.style.display = "block";
        setTimeout(() => {
          bannerEl.style.display = "none";
        }, 5000);
      }

      function updateDisplays() {
        eggCountEl.textContent = "‚õì-Ei: " + count;
        if (merchantCount > 0) {
          merchantCountEl.style.display = "block";
          merchantCountEl.textContent = "H√§ndler: " + merchantCount;
        } else {
          merchantCountEl.style.display = "none";
        }
        if (farmerCount > 0) {
          farmerCountEl.style.display = "block";
          farmerCountEl.textContent = "Farmer: " + farmerCount;
        } else {
          farmerCountEl.style.display = "none";
        }
        if (chickenCount > 1) {
          chickenCountEl.style.display = "block";
          chickenCountEl.textContent = "‚õì-H√ºhner: " + chickenCount;
        } else {
          chickenCountEl.style.display = "none";
        }
        const nextGoal = progressGoals[progressStage];
        if (nextGoal !== undefined) {
          goldCountEl.textContent = "ü™ô " + gold + "/" + nextGoal;
        } else {
          goldCountEl.textContent = "ü™ô " + gold;
        }
        if (!merchantVisible && gold >= 5) {
          merchantBtn.style.display = "inline";
          merchantVisible = true;
        }
        if (!buyChickenVisible && gold >= 10) {
          buyChickenBtn.style.display = "inline";
          buyChickenVisible = true;
        }
        if (!farmerVisible && gold >= 15) {
          farmerBtn.style.display = "inline";
          farmerVisible = true;
        }
        if (!farmBuilt && gold >= 100) {
          buyFarmBtn.style.display = "inline";
        } else {
          buyFarmBtn.style.display = "none";
        }
        farmEl.style.display = farmBuilt ? "block" : "none";
        farmFarmerCountEl.textContent = "Farmer: " + farmFarmers;
        farmMerchantCountEl.textContent = "H√§ndler: " + farmMerchants;
        farmChickenTypeEl.textContent = farmChickenAssigned
          ? "‚õìfighaltungsh√ºhner"
          : "Keine H√ºhner";
        if (progressStage >= 3 && gold >= 100 && !chapter2Shown) {
          showBanner("Kapitel 2: Markteinf√ºhrung");
          chapter2Shown = true;
        }
      }

      // Initial display update
      updateDisplays();

      function spawnEgg(amount) {
        for (let i = 0; i < amount; i++) {
          const egg = document.createElement("div");
          egg.className = "egg";
          egg.textContent = "ü•ö";
          document.getElementById("container").appendChild(egg);
          setTimeout(() => egg.remove(), 3000);
        }
      }

      function produceEgg() {
        if (chickenCount <= 0) return;
        count += chickenCount;
        if (count >= 50) {
          sellBtn.style.display = "inline";
        }
        spawnEgg(chickenCount);
        updateDisplays();
      }

      chicken.addEventListener("mousedown", () => {
        produceEgg();
        clickInterval = setInterval(produceEgg, 500);
      });

      ["mouseup", "mouseleave"].forEach((ev) => {
        chicken.addEventListener(ev, () => clearInterval(clickInterval));
      });

      sellBtn.addEventListener("click", () => {
        if (count >= 8) {
          count -= 8;
          gold += 1;
          updateDisplays();
        }
      });

      merchantBtn.addEventListener("click", () => {
        if (gold >= 5) {
          gold -= 5;
          merchantCount += 1;
          if (progressStage === 0) {
            progressStage += 1;
          }
          updateDisplays();
        }
      });

      farmerBtn.addEventListener("click", () => {
        if (gold >= 15) {
          gold -= 15;
          farmerCount += 1;
          if (progressStage === 2) {
            progressStage += 1;
          }
          updateDisplays();
        }
      });

      buyChickenBtn.addEventListener("click", () => {
        if (gold >= 10) {
          gold -= 10;
          if (farmChickenAssigned) {
            farmChickenCount += 1;
          } else {
            chickenCount += 1;
          }
          if (progressStage === 1) {
            progressStage += 1;
          }
          updateDisplays();
        }
      });

      buyFarmBtn.addEventListener("click", () => {
        if (gold >= 100 && !farmBuilt) {
          gold -= 100;
          farmBuilt = true;
          progressStage += 1;
          updateDisplays();
        }
      });

      assignFarmerBtn.addEventListener("click", () => {
        if (farmerCount > 0 && farmBuilt) {
          farmerCount -= 1;
          farmFarmers += 1;
          updateDisplays();
        }
      });

      assignMerchantBtn.addEventListener("click", () => {
        if (merchantCount > 0 && farmBuilt) {
          merchantCount -= 1;
          farmMerchants += 1;
          updateDisplays();
        }
      });

      assignChickenBtn.addEventListener("click", () => {
        if (farmBuilt && !farmChickenAssigned && chickenCount > 0) {
          farmChickenAssigned = true;
          farmChickenCount += chickenCount;
          chickenCount = 0;
          farmMultiplier = 1.15;
          document.getElementById("container").style.display = "none";
          updateDisplays();
        }
      });

      setInterval(() => {
        if (farmerCount > 0 && chickenCount > 0) {
          count += farmerCount;
          if (count >= 50) {
            sellBtn.style.display = "inline";
          }
          spawnEgg(farmerCount);
          updateDisplays();
        }
        if (farmBuilt && farmChickenAssigned && farmFarmers > 0) {
          const produced = Math.round(farmFarmers * farmMultiplier);
          count += produced;
          if (count >= 50) {
            sellBtn.style.display = "inline";
          }
          spawnEgg(produced);
          updateDisplays();
        }
      }, 1000);

      setInterval(() => {
        const possibleSales = Math.floor(count / 8);
        const sales = Math.min(merchantCount + farmMerchants, possibleSales);
        if (sales > 0) {
          count -= sales * 8;
          gold += sales;
          updateDisplays();
        }
      }, 5000);
    </script>
  </body>
</html>
